<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title></title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="R.css" />
</head><body>

<table width="100%" summary="page for xEnrichMatrix"><tr><td>xEnrichMatrix</td><td style="text-align: right;">R Documentation</td></tr></table>

<h2>xEnrichMatrix</h2>

<h3>Usage</h3>

<pre>
xEnrichMatrix(list_eTerm, method = c("ggplot2", "circle", "square",
"color", "pie"), displayBy = c("zscore", "fc", "adjp", "pvalue"),
FDR.cutoff = 0.05, wrap.width = NULL, sharings = NULL, reorder =
c("row", "none", "col", "both"), colormap = "jet", ncolors = 20, zlim =
NULL, slim = NULL, legend.direction = c("horizontal", "vertical"),
title = NULL, flip = FALSE, y.rotate = 45, shape = 19, font.family =
"sans", ...)
</pre>


<h3>Arguments</h3>

<table summary="R argblock">
<tr valign="top"><td><code>list_eTerm</code></td>
<td>


</td></tr>
<tr valign="top"><td><code>method</code></td>
<td>


</td></tr>
<tr valign="top"><td><code>displayBy</code></td>
<td>


</td></tr>
<tr valign="top"><td><code>FDR.cutoff</code></td>
<td>


</td></tr>
<tr valign="top"><td><code>wrap.width</code></td>
<td>


</td></tr>
<tr valign="top"><td><code>sharings</code></td>
<td>


</td></tr>
<tr valign="top"><td><code>reorder</code></td>
<td>


</td></tr>
<tr valign="top"><td><code>colormap</code></td>
<td>


</td></tr>
<tr valign="top"><td><code>ncolors</code></td>
<td>


</td></tr>
<tr valign="top"><td><code>zlim</code></td>
<td>


</td></tr>
<tr valign="top"><td><code>slim</code></td>
<td>


</td></tr>
<tr valign="top"><td><code>legend.direction</code></td>
<td>


</td></tr>
<tr valign="top"><td><code>title</code></td>
<td>


</td></tr>
<tr valign="top"><td><code>flip</code></td>
<td>


</td></tr>
<tr valign="top"><td><code>y.rotate</code></td>
<td>


</td></tr>
<tr valign="top"><td><code>shape</code></td>
<td>


</td></tr>
<tr valign="top"><td><code>font.family</code></td>
<td>


</td></tr>
<tr valign="top"><td><code>...</code></td>
<td>


</td></tr>
</table>


<h3>Examples</h3>

<pre>
##---- Should be DIRECTLY executable !! ----
##-- ==&gt;  Define data, use random,
##--	or do  help(data=index)  for the standard data sets.

## The function is currently defined as
function (list_eTerm, method = c("ggplot2", "circle", "square",
"color", "pie"), displayBy = c("zscore", "fc", "adjp", "pvalue"),
FDR.cutoff = 0.05, wrap.width = NULL, sharings = NULL, reorder =
c("row",
"none", "col", "both"), colormap = "jet", ncolors = 20,
zlim = NULL, slim = NULL, legend.direction = c("horizontal",
"vertical"), title = NULL, flip = FALSE, y.rotate = 45,
shape = 19, font.family = "sans", ...)
{
method &lt;- match.arg(method)
displayBy &lt;- match.arg(displayBy)
reorder &lt;- match.arg(reorder)
legend.direction &lt;- match.arg(legend.direction)
if (class(list_eTerm) == "list") {
list_eTerm &lt;- base::Filter(base::Negate(is.null), list_eTerm)
list_names &lt;- names(list_eTerm)
if (is.null(list_names)) {
list_names &lt;- paste("Enrichment", 1:length(list_eTerm),
sep = " ")
}
res_ls &lt;- lapply(1:length(list_eTerm), function(i) {
df &lt;- xEnrichViewer(list_eTerm[[i]], top_num = "all",
sortBy = "none")
if (is.null(df)) {
return(NULL)
}
else {
cbind(group = rep(list_names[i], nrow(df)), id = rownames(df),
df, stringsAsFactors = F)
}
})
df_all &lt;- do.call(rbind, res_ls)
rownames(df_all) &lt;- NULL
ind &lt;- which(df_all$adjp &lt; FDR.cutoff)
d &lt;- df_all[ind, c("id", "name", "fc", "adjp", "zscore",
"pvalue", "group")]
}
else if (class(list_eTerm) == "data.frame") {
ind &lt;- colnames(list_eTerm) %in% c("group", "name", "adjp",
displayBy)
if (sum(ind) == 4) {
df_all &lt;- list_eTerm
ind &lt;- which(df_all$adjp &lt; FDR.cutoff)
d &lt;- df_all[ind, ]
if (is.factor(d$group)) {
list_names &lt;- levels(d$group)
}
else {
list_names &lt;- unique(d$group)
}
}
else {
return(NULL)
}
}
d$group &lt;- factor(d$group, levels = rev(list_names))
id_ls &lt;- split(x = d$group, f = d$name)
ind &lt;- match(d$name, names(id_ls))
id_full_ls &lt;- id_ls[ind]
nSig &lt;- unlist(lapply(id_full_ls, length))
d$nSig &lt;- nSig
code &lt;- lapply(id_full_ls, function(x) {
res &lt;- rep(0, length(levels(x)))
ind &lt;- match(x, levels(x))
res[ind] &lt;- 1
paste(res, collapse = "-")
})
d$code &lt;- unlist(code)
if (!is.null(wrap.width)) {
width &lt;- as.integer(wrap.width)
res_list &lt;- lapply(d$name, function(x) {
x &lt;- gsub("_", " ", x)
y &lt;- strwrap(x, width = width)
if (length(y) &gt; 1) {
paste0(y[1], "...")
}
else {
y
}
})
d$name &lt;- unlist(res_list)
}
if (!is.null(sharings)) {
sharings &lt;- as.numeric(sharings)
ind &lt;- match(sharings, unique(d$nSig))
found &lt;- sharings[!is.na(ind)]
if (length(found) &gt; 0) {
flag &lt;- match(d$nSig, found)
d &lt;- d[!is.na(flag), ]
nSig &lt;- nSig[!is.na(flag)]
}
}
if (displayBy == "fc") {
d &lt;- d[with(d, order(nSig, group, fc, -adjp)), ]
if (!is.factor(d$name)) {
d$name &lt;- factor(d$name, levels = unique(d$name))
}
d$val &lt;- d$fc
mat_val &lt;- as.matrix(xSparseMatrix(d[, c("name", "group",
"val")], rows = levels(d$name), columns = levels(d$group)))
mat_val[mat_val == 0] &lt;- 1
title_size &lt;- "FC"
}
else if (displayBy == "adjp") {
d$adjp[d$adjp == 0] &lt;- min(d$adjp[d$adjp != 0])
d &lt;- d[with(d, order(nSig, group, -adjp)), ]
if (!is.factor(d$name)) {
d$name &lt;- factor(d$name, levels = unique(d$name))
}
d$val &lt;- -1 * log10(d$adjp)
mat_val &lt;- as.matrix(xSparseMatrix(d[, c("name", "group",
"val")], rows = levels(d$name), columns = levels(d$group)))
title_size &lt;- "-log10(FDR)"
}
else if (displayBy == "zscore") {
d &lt;- d[with(d, order(nSig, group, zscore, -adjp)), ]
if (!is.factor(d$name)) {
d$name &lt;- factor(d$name, levels = unique(d$name))
}
d$val &lt;- d$zscore
mat_val &lt;- as.matrix(xSparseMatrix(d[, c("name", "group",
"val")], rows = levels(d$name), columns = levels(d$group)))
title_size &lt;- "Z-score"
}
else if (displayBy == "pvalue") {
d$pvalue[d$pvalue == 0] &lt;- min(d$pvalue[d$pvalue != 0])
d &lt;- d[with(d, order(nSig, group, -pvalue)), ]
if (!is.factor(d$name)) {
d$name &lt;- factor(d$name, levels = unique(d$name))
}
d$val &lt;- -1 * log10(d$pvalue)
mat_val &lt;- as.matrix(xSparseMatrix(d[, c("name", "group",
"val")], rows = levels(d$name), columns = levels(d$group)))
title_size &lt;- "-log10(p-value)"
}
d$bycol &lt;- -1 * log10(d$adjp)
mat_fdr &lt;- as.matrix(xSparseMatrix(d[, c("name", "group",
"adjp")], rows = levels(d$name), columns = levels(d$group)))
mat_fdr[mat_fdr == 0] &lt;- 1
ind_row &lt;- 1:nrow(mat_val)
if (reorder == "row" | reorder == "both") {
ind_row &lt;- match(levels(d$name), rownames(mat_val))
}
ind_row &lt;- rev(ind_row)
ind_col &lt;- 1:ncol(mat_val)
if (reorder == "col" | reorder == "both") {
mat &lt;- mat_val
colnames(mat) &lt;- 1:ncol(mat)
rownames(mat) &lt;- 1:nrow(mat)
tree_bs &lt;- visTreeBootstrap(t(mat), visTree = FALSE)
ind_col &lt;- match(tree_bs$tip.label, colnames(mat))
}
mat_val &lt;- mat_val[ind_row, ind_col]
mat_fdr &lt;- mat_fdr[ind_row, ind_col]
if (is.null(slim)) {
slim &lt;- c(min(mat_val), max(mat_val))
}
mat_val[mat_val &lt;= slim[1]] &lt;- slim[1]
mat_val[mat_val &gt;= slim[2]] &lt;- slim[2]
if (method != "ggplot2") {
if (is.null(title)) {
corrplot::corrplot(mat_val, method = method, is.cor = FALSE,
col = xColormap(colormap)(ncolors), cl.lim = c(zlim[1],
zlim[2]), p.mat = mat_fdr, sig.level = FDR.cutoff,
insig = "blank", addgrid.col = "transparent",
mar = c(0.1, 0.1, 1, 0.1), ...)
}
else {
corrplot::corrplot(mat_val, method = method, is.cor = FALSE,
col = xColormap(colormap)(ncolors), cl.lim = c(zlim[1],
zlim[2]), p.mat = mat_fdr, sig.level = FDR.cutoff,
insig = "blank", addgrid.col = "transparent",
mar = c(0.1, 0.1, 1, 0.1), title = title, ...)
}
invisible(d)
}
else {
if (flip) {
d$group &lt;- factor(d$group, levels = rev(colnames(mat_val)))
d$name &lt;- factor(d$name, levels = rownames(mat_val))
}
else {
d$group &lt;- factor(d$group, levels = colnames(mat_val))
d$name &lt;- factor(d$name, levels = rev(rownames(mat_val)))
}
d$val[d$val &lt;= slim[1]] &lt;- slim[1]
d$val[d$val &gt;= slim[2]] &lt;- slim[2]
if (is.null(zlim)) {
zlim &lt;- c(0, ceiling(max(d$bycol) * 10)/10)
}
d$bycol[d$bycol &gt;= zlim[2]] &lt;- zlim[2]
group &lt;- name &lt;- val &lt;- zscore &lt;- bycol &lt;- NULL
gp &lt;- ggplot(d, aes(x = group, y = name, color = bycol))
gp &lt;- gp + geom_point(aes(size = val), shape = shape)
if (legend.direction == "vertical") {
gp &lt;- gp + scale_size_continuous(limits = c(floor(min(d$val) *
10)/10, ceiling(max(d$val) * 10)/10), range = c(1,
4), guide = guide_legend(title_size, title.position = "top",
ncol = 1, order = 1))
gp &lt;- gp + scale_colour_gradientn(colors =
xColormap(colormap)(ncolors),
limits = zlim, guide = guide_colorbar(title =
expression(-log[10]("FDR")),
title.position = "top", barwidth = 0.5, order = 2))
}
else if (legend.direction == "horizontal") {
gp &lt;- gp + scale_size_continuous(limits = c(floor(min(d$val) *
10)/10, ceiling(max(d$val) * 10)/10), range = c(1,
4), guide = guide_legend(title_size, title.position = "top",
keywidth = 0.5, keyheight = 0.5, ncol = 3, byrow = T,
order = 1))
gp &lt;- gp + scale_colour_gradientn(colors =
xColormap(colormap)(ncolors),
limits = zlim, guide = guide_colorbar(title =
expression(-log[10]("FDR")),
title.position = "top", , barheight = 0.5,
direction = "horizontal", order = 2))
}
gp &lt;- gp + theme_bw() + theme(legend.position = "right",
axis.title.x = element_blank(), axis.title.y = element_blank(),
axis.text.x = element_text(face = "bold", color = "black",
size = 8, angle = y.rotate), axis.text.y = element_text(face = "bold",
color = "black", size = 8, angle = 0), panel.background =
element_rect(fill = "transparent")) +
theme(panel.grid.major = element_blank(), panel.grid.minor =
element_blank())
gp &lt;- gp + labs(title = title)
gp &lt;- gp + theme(text = element_text(family = font.family))
gp &lt;- gp + scale_x_discrete(position = "top")
if (flip) {
gp &lt;- gp + coord_flip() + scale_x_discrete(position = "bottom") +
scale_y_discrete(position = "right")
gp &lt;- gp + theme(axis.text.x = element_text(face = "bold",
color = "black", size = 8, angle = y.rotate,
hjust = 0))
}
invisible(gp)
}
}
</pre>


</body></html>
