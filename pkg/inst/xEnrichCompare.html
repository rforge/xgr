<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title></title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="R.css" />
</head><body>

<table width="100%" summary="page for xEnrichCompare"><tr><td>xEnrichCompare</td><td style="text-align: right;">R Documentation</td></tr></table>

<h2>xEnrichCompare</h2>

<h3>Usage</h3>

<pre>
xEnrichCompare(list_eTerm, displayBy = c("fc", "adjp", "fdr", "zscore",
"pvalue"), FDR.cutoff = 0.05, bar.label = TRUE, bar.label.size = 2.5,
wrap.width = NULL, sharings = NULL, font.family = "sans", facet = TRUE,
signature = TRUE)
</pre>


<h3>Arguments</h3>

<table summary="R argblock">
<tr valign="top"><td><code>list_eTerm</code></td>
<td>


</td></tr>
<tr valign="top"><td><code>displayBy</code></td>
<td>


</td></tr>
<tr valign="top"><td><code>FDR.cutoff</code></td>
<td>


</td></tr>
<tr valign="top"><td><code>bar.label</code></td>
<td>


</td></tr>
<tr valign="top"><td><code>bar.label.size</code></td>
<td>


</td></tr>
<tr valign="top"><td><code>wrap.width</code></td>
<td>


</td></tr>
<tr valign="top"><td><code>sharings</code></td>
<td>


</td></tr>
<tr valign="top"><td><code>font.family</code></td>
<td>


</td></tr>
<tr valign="top"><td><code>facet</code></td>
<td>


</td></tr>
<tr valign="top"><td><code>signature</code></td>
<td>


</td></tr>
</table>


<h3>Examples</h3>

<pre>
##---- Should be DIRECTLY executable !! ----
##-- ==&gt;  Define data, use random,
##--	or do  help(data=index)  for the standard data sets.

## The function is currently defined as
function (list_eTerm, displayBy = c("fc", "adjp", "fdr", "zscore",
"pvalue"), FDR.cutoff = 0.05, bar.label = TRUE, bar.label.size = 2.5,
wrap.width = NULL, sharings = NULL, font.family = "sans",
facet = TRUE, signature = TRUE)
{
displayBy &lt;- match.arg(displayBy)
list_eTerm &lt;- base::Filter(base::Negate(is.null), list_eTerm)
if (length(list_eTerm) == 0) {
return(NULL)
}
list_names &lt;- names(list_eTerm)
if (is.null(list_names)) {
list_names &lt;- paste("Enrichment", 1:length(list_eTerm),
sep = " ")
}
res_ls &lt;- lapply(1:length(list_eTerm), function(i) {
df &lt;- xEnrichViewer(list_eTerm[[i]], top_num = "all",
sortBy = "none")
if (is.null(df)) {
return(NULL)
}
else {
cbind(group = rep(list_names[i], nrow(df)), id = rownames(df),
df, stringsAsFactors = F)
}
})
df_all &lt;- do.call(rbind, res_ls)
rownames(df_all) &lt;- NULL
ind &lt;- which(df_all$adjp &lt; FDR.cutoff)
d &lt;- df_all[ind, c("id", "name", "fc", "adjp", "zscore",
"pvalue", "group")]
d$group &lt;- factor(d$group, levels = rev(list_names))
if (!is.null(wrap.width)) {
width &lt;- as.integer(wrap.width)
res_list &lt;- lapply(d$name, function(x) {
x &lt;- gsub("_", " ", x)
y &lt;- strwrap(x, width = width)
if (length(y) &gt; 1) {
paste0(y[1], "...")
}
else {
y
}
})
d$name &lt;- unlist(res_list)
}
id_ls &lt;- split(x = d$group, f = d$id)
ind &lt;- match(d$id, names(id_ls))
id_full_ls &lt;- id_ls[ind]
nSig &lt;- unlist(lapply(id_full_ls, length))
d$nSig &lt;- nSig
code &lt;- lapply(id_full_ls, function(x) {
res &lt;- rep(0, length(levels(x)))
ind &lt;- match(x, levels(x))
res[ind] &lt;- 1
paste(res, collapse = "-")
})
d$code &lt;- unlist(code)
if (!is.null(sharings)) {
sharings &lt;- as.numeric(sharings)
ind &lt;- match(sharings, unique(d$nSig))
found &lt;- sharings[!is.na(ind)]
if (length(found) &gt; 0) {
flag &lt;- match(d$nSig, found)
d &lt;- d[!is.na(flag), ]
nSig &lt;- nSig[!is.na(flag)]
}
}
name &lt;- fc &lt;- group &lt;- adjp &lt;- zscore &lt;- pvalue &lt;- label &lt;- direction
&lt;- height &lt;- hjust &lt;- NULL
d &lt;- d %&gt;% dplyr::mutate(direction = ifelse(zscore &gt; 0, 1,
-1))
if (displayBy == "fc") {
d &lt;- d %&gt;% dplyr::arrange(nSig, group, direction, fc,
desc(adjp)) %&gt;% dplyr::mutate(height = log2(fc)) %&gt;%
dplyr::mutate(hjust = ifelse(height &gt;= 0, 1, 0))
d$name &lt;- factor(d$name, levels = unique(d$name))
ind &lt;- match(unique(d$id), names(nSig))
xintercept &lt;- which(!duplicated(nSig[ind]))[-1]
p &lt;- ggplot(d, aes(x = name, y = height, fill = group))
p &lt;- p + ylab(expression(paste("Enrichment changes: ",
log[2]("FC"))))
}
else if (displayBy == "adjp" | displayBy == "fdr") {
d &lt;- d %&gt;% dplyr::arrange(nSig, group, direction, desc(adjp),
zscore) %&gt;% dplyr::mutate(height = -1 * log10(adjp)) %&gt;%
dplyr::mutate(hjust = 1)
d$name &lt;- factor(d$name, levels = unique(d$name))
ind &lt;- match(unique(d$id), names(nSig))
xintercept &lt;- which(!duplicated(nSig[ind]))[-1]
p &lt;- ggplot(d, aes(x = name, y = height, fill = group))
p &lt;- p + ylab(expression(paste("Enrichment significance: ",
-log[10]("FDR"))))
}
else if (displayBy == "zscore") {
d &lt;- d %&gt;% dplyr::arrange(nSig, group, direction, zscore,
desc(adjp)) %&gt;% dplyr::mutate(height = zscore) %&gt;%
dplyr::mutate(hjust = ifelse(height &gt;= 0, 1, 0))
d$name &lt;- factor(d$name, levels = unique(d$name))
ind &lt;- match(unique(d$id), names(nSig))
xintercept &lt;- which(!duplicated(nSig[ind]))[-1]
p &lt;- ggplot(d, aes(x = name, y = height, fill = group))
p &lt;- p + ylab("Enrichment z-scores")
}
else if (displayBy == "pvalue") {
d &lt;- d %&gt;% dplyr::arrange(nSig, group, direction, desc(pvalue),
zscore) %&gt;% dplyr::mutate(height = -1 * log10(pvalue)) %&gt;%
dplyr::mutate(hjust = 1)
d$name &lt;- factor(d$name, levels = unique(d$name))
ind &lt;- match(unique(d$id), names(nSig))
xintercept &lt;- which(!duplicated(nSig[ind]))[-1]
p &lt;- ggplot(d, aes(x = name, y = height, fill = group))
p &lt;- p + ylab(expression(paste("Enrichment significance: ",
-log[10]("p-value"))))
}
bp &lt;- p + geom_bar(stat = "identity") + theme_bw() +
theme(legend.position = "none",
legend.title = element_blank(), axis.title.y = element_blank(),
axis.text.y = element_text(size = 10, color = "black"),
axis.title.x = element_text(size = 14, color = "black")) +
geom_vline(xintercept = xintercept - 0.5, color = "black",
linetype = "dotdash") + coord_flip()
bp &lt;- bp + theme(panel.grid.major = element_blank(), panel.grid.minor =
element_blank())
bp &lt;- bp + theme(strip.background = element_rect(fill = "transparent",
color = "transparent"), strip.text = element_text(size = 12,
face = "italic"))
if (bar.label) {
to_scientific_notation &lt;- function(x) {
res &lt;- format(x, scientific = T)
res &lt;- sub("\+0?", "", res)
sub("-0?", "-", res)
}
label &lt;- to_scientific_notation(d$adjp)
d$label &lt;- paste("FDR", as.character(label), sep = "=")
df_sub &lt;- d %&gt;% dplyr::filter(hjust == 1)
bp &lt;- bp + geom_text(data = df_sub, aes(label = label),
hjust = 1, size = bar.label.size, family = font.family)
df_sub &lt;- d %&gt;% dplyr::filter(hjust == 0)
bp &lt;- bp + geom_text(data = df_sub, aes(label = label),
hjust = 0, size = bar.label.size, family = font.family)
}
title &lt;- paste0("Enrichments (FDR &lt; ", FDR.cutoff, ")")
bp &lt;- bp + labs(title = title) + theme(plot.title = element_text(hjust
= 0.5))
if (signature) {
caption &lt;- paste("Created by xEnrichCompare from XGR version",
utils::packageVersion("XGR"))
bp &lt;- bp + labs(caption = caption) + theme(plot.caption =
element_text(hjust = 1,
face = "bold.italic", size = 8, colour = "#002147"))
}
bp &lt;- bp + theme(text = element_text(family = font.family))
bp &lt;- bp + theme(axis.line.x = element_line(arrow = arrow(angle = 30,
length = unit(0.25, "cm"), type = "open")))
if (facet) {
bp &lt;- bp + facet_grid(~group)
}
else {
bp &lt;- bp + theme(legend.position = "bottom", legend.title =
element_text(size = 10,
color = "black", face = "bold")) + guides(fill = guide_legend(title =
"",
title.position = "left", reverse = TRUE, nrow = 1,
byrow = TRUE))
}
flag &lt;- sapply(list_eTerm, function(x) !is.null(x$g))
if (all(flag)) {
ls_edges &lt;- lapply(list_eTerm, function(x) {
df_edge &lt;- igraph::get.data.frame(x$g, what = "edges")
})
relations &lt;- do.call(rbind, ls_edges)
relations &lt;- relations[!duplicated(relations), ]
ls_nodes &lt;- lapply(list_eTerm, function(x) {
df_nodes &lt;- igraph::get.data.frame(x$g, what = "vertices")
})
nodes &lt;- do.call(rbind, ls_nodes)[, 1:4]
nodes &lt;- nodes[!duplicated(nodes), ]
ig &lt;- igraph::graph.data.frame(d = relations, directed = T,
vertices = nodes)
bp$g &lt;- ig
}
invisible(bp)
}
</pre>


</body></html>
