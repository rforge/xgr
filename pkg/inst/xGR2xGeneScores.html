<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title></title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="R.css" />
</head><body>

<table width="100%" summary="page for xGR2xGeneScores"><tr><td>xGR2xGeneScores</td><td style="text-align: right;">R Documentation</td></tr></table>

<h2>xGR2xGeneScores</h2>

<h3>Usage</h3>

<pre>
xGR2xGeneScores(data, significance.threshold = NULL, score.cap = NULL,
build.conversion = c(NA, "hg38.to.hg19", "hg18.to.hg19"), crosslink =
c("genehancer", "PCHiC_combined", "GTEx_V6p_combined", "nearby"),
crosslink.customised = NULL, cdf.function = c("original", "empirical"),
scoring.scheme = c("max", "sum", "sequential"), nearby.distance.max =
50000, nearby.decay.kernel = c("rapid", "slow", "linear", "constant"),
nearby.decay.exponent = 2, verbose = T, RData.location =
"http://galahad.well.ox.ac.uk/bigdata", guid = NULL)
</pre>


<h3>Arguments</h3>

<table summary="R argblock">
<tr valign="top"><td><code>data</code></td>
<td>


</td></tr>
<tr valign="top"><td><code>significance.threshold</code></td>
<td>


</td></tr>
<tr valign="top"><td><code>score.cap</code></td>
<td>


</td></tr>
<tr valign="top"><td><code>build.conversion</code></td>
<td>


</td></tr>
<tr valign="top"><td><code>crosslink</code></td>
<td>


</td></tr>
<tr valign="top"><td><code>crosslink.customised</code></td>
<td>


</td></tr>
<tr valign="top"><td><code>cdf.function</code></td>
<td>


</td></tr>
<tr valign="top"><td><code>scoring.scheme</code></td>
<td>


</td></tr>
<tr valign="top"><td><code>nearby.distance.max</code></td>
<td>


</td></tr>
<tr valign="top"><td><code>nearby.decay.kernel</code></td>
<td>


</td></tr>
<tr valign="top"><td><code>nearby.decay.exponent</code></td>
<td>


</td></tr>
<tr valign="top"><td><code>verbose</code></td>
<td>


</td></tr>
<tr valign="top"><td><code>RData.location</code></td>
<td>


</td></tr>
<tr valign="top"><td><code>guid</code></td>
<td>


</td></tr>
</table>


<h3>Examples</h3>

<pre>
##---- Should be DIRECTLY executable !! ----
##-- ==&gt;  Define data, use random,
##--	or do  help(data=index)  for the standard data sets.

## The function is currently defined as
function (data, significance.threshold = NULL, score.cap = NULL,
build.conversion = c(NA, "hg38.to.hg19", "hg18.to.hg19"),
crosslink = c("genehancer", "PCHiC_combined", "GTEx_V6p_combined",
"nearby"), crosslink.customised = NULL, cdf.function = c("original",
"empirical"), scoring.scheme = c("max", "sum", "sequential"),
nearby.distance.max = 50000, nearby.decay.kernel = c("rapid",
"slow", "linear", "constant"), nearby.decay.exponent = 2,
verbose = T, RData.location = "http://galahad.well.ox.ac.uk/bigdata",
guid = NULL)
{
build.conversion &lt;- match.arg(build.conversion)
cdf.function &lt;- match.arg(cdf.function)
scoring.scheme &lt;- match.arg(scoring.scheme)
nearby.decay.kernel &lt;- match.arg(nearby.decay.kernel)
if (verbose) {
now &lt;- Sys.time()
message(sprintf("\n#######################################################",
appendLF = T))
message(sprintf("'xGRscores' is being called to score GR (%s):",
as.character(now)), appendLF = T)
message(sprintf("#######################################################",
appendLF = T))
}
df_GR &lt;- xGRscores(data = data, significance.threshold =
significance.threshold,
score.cap = score.cap, verbose = verbose)
if (verbose) {
now &lt;- Sys.time()
message(sprintf("#######################################################",
appendLF = T))
message(sprintf("'xGRscores' has been finished (%s)!",
as.character(now)), appendLF = T)
message(sprintf("#######################################################\n",
appendLF = T))
}
if (verbose) {
now &lt;- Sys.time()
message(sprintf("\n#######################################################",
appendLF = T))
message(sprintf("'xGR2xGenes' is being called to define crosslinked
genes (%s):",
as.character(now)), appendLF = T)
message(sprintf("#######################################################",
appendLF = T))
}
df_xGenes &lt;- xGR2xGenes(data = df_GR$GR, format = "chr:start-end",
build.conversion = build.conversion, crosslink = crosslink,
crosslink.customised = crosslink.customised, cdf.function =
cdf.function,
scoring = F, nearby.distance.max = nearby.distance.max,
nearby.decay.kernel = nearby.decay.kernel, nearby.decay.exponent =
nearby.decay.exponent,
verbose = verbose, silent = !verbose, RData.location = RData.location,
guid = guid)
if (verbose) {
now &lt;- Sys.time()
message(sprintf("#######################################################",
appendLF = T))
message(sprintf("'xGR2xGenes' has been finished (%s)!",
as.character(now)), appendLF = T)
message(sprintf("#######################################################\n",
appendLF = T))
}
if (1) {
ind &lt;- match(df_xGenes$GR, df_GR$GR)
score &lt;- df_xGenes$Score * df_GR$Score[ind]
df_link &lt;- data.frame(GR = df_xGenes$GR, Gene = df_xGenes$Gene,
Score = score, Score_GR = df_GR$Score[ind], Score_link =
df_xGenes$Score,
stringsAsFactors = FALSE)
df_link &lt;- df_link[order(-df_link$Score, decreasing = FALSE),
]
ind &lt;- xGRsort(df_link$GR)
df_link &lt;- df_link[ind, ]
Gene2GR &lt;- data.frame(Gene = df_xGenes$Gene, GR = df_xGenes$GR,
Score = score, stringsAsFactors = FALSE)
Gene2GR &lt;- Gene2GR[order(Gene2GR$Gene, -Gene2GR$Score,
decreasing = FALSE), ]
Gene &lt;- Score &lt;- NULL
if (scoring.scheme == "max") {
summaryFun &lt;- max
}
else if (scoring.scheme == "sum") {
summaryFun &lt;- sum
}
else if (scoring.scheme == "sequential") {
summaryFun &lt;- function(x) {
base::sum(x/base::rank(-x, ties.method = "min"))
}
}
tmp &lt;- as.data.frame(df_xGenes %&gt;% dplyr::group_by(Gene) %&gt;%
dplyr::summarise(Score = summaryFun(Score)))
seeds.genes &lt;- tmp$Score
names(seeds.genes) &lt;- tmp$Gene
}
rescaleFun &lt;- function(x) {
0.100001 + 0.9 * 0.99999888888 * (x - min(x))/(max(x) -
min(x))
}
x &lt;- rescaleFun(seeds.genes)
pval &lt;- 10^(-x * 10)
df_Gene &lt;- data.frame(Gene = names(seeds.genes), Score = seeds.genes,
Pval = pval, row.names = NULL, stringsAsFactors = F)
df_Gene &lt;- df_Gene[order(df_Gene$Score, decreasing = TRUE),
]
if (verbose) {
now &lt;- Sys.time()
message(sprintf("In summary, %d Genes are defined as seeds from a list
of %d (out of %d) genomic regions and scored using '%s' scoring
scheme",
length(seeds.genes), length(unique(df_xGenes$GR)),
nrow(df_GR), scoring.scheme, as.character(now)),
appendLF = T)
}
df_GR &lt;- df_GR[order(df_GR$Score, df_GR$GR, decreasing = TRUE),
]
mSeed &lt;- list(GR = df_GR, Gene = df_Gene, Link = df_link)
class(mSeed) &lt;- "mSeed"
invisible(mSeed)
}
</pre>


</body></html>
