<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title></title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="R.css" />
</head><body>

<table width="100%" summary="page for xSNP2cGenes"><tr><td>xSNP2cGenes</td><td style="text-align: right;">R Documentation</td></tr></table>

<h2>xSNP2cGenes</h2>

<h3>Usage</h3>

<pre>
xSNP2cGenes(data, entity = c("SNP", "chr:start-end", "data.frame",
"bed", "GRanges"), include.HiC = NA, GR.SNP = c("dbSNP_GWAS",
"dbSNP_Common"), cdf.function = c("empirical", "exponential"), plot =
FALSE, verbose = TRUE, RData.location =
"http://galahad.well.ox.ac.uk/bigdata", guid = NULL)
</pre>


<h3>Arguments</h3>

<table summary="R argblock">
<tr valign="top"><td><code>data</code></td>
<td>


</td></tr>
<tr valign="top"><td><code>entity</code></td>
<td>


</td></tr>
<tr valign="top"><td><code>include.HiC</code></td>
<td>


</td></tr>
<tr valign="top"><td><code>GR.SNP</code></td>
<td>


</td></tr>
<tr valign="top"><td><code>cdf.function</code></td>
<td>


</td></tr>
<tr valign="top"><td><code>plot</code></td>
<td>


</td></tr>
<tr valign="top"><td><code>verbose</code></td>
<td>


</td></tr>
<tr valign="top"><td><code>RData.location</code></td>
<td>


</td></tr>
<tr valign="top"><td><code>guid</code></td>
<td>


</td></tr>
</table>


<h3>Examples</h3>

<pre>
##---- Should be DIRECTLY executable !! ----
##-- ==&gt;  Define data, use random,
##--	or do  help(data=index)  for the standard data sets.

## The function is currently defined as
function (data, entity = c("SNP", "chr:start-end", "data.frame",
"bed", "GRanges"), include.HiC = NA, GR.SNP = c("dbSNP_GWAS",
"dbSNP_Common"), cdf.function = c("empirical", "exponential"),
plot = FALSE, verbose = TRUE, RData.location =
"http://galahad.well.ox.ac.uk/bigdata",
guid = NULL)
{
entity &lt;- match.arg(entity)
cdf.function &lt;- match.arg(cdf.function)
df_FTS &lt;- xDefineHIC(data = NULL, include.HiC = include.HiC,
verbose = verbose, RData.location = RData.location, guid = guid)
if (is.null(data)) {
return(NULL)
}
PCHiC &lt;- xDefineHIC(data = data, entity = entity, include.HiC =
include.HiC,
GR.SNP = GR.SNP, verbose = verbose, RData.location = RData.location,
guid = guid)
df_data &lt;- PCHiC$df
if (!is.null(df_FTS)) {
uid &lt;- paste(df_FTS[, 1], df_FTS[, 2], sep = "_")
df &lt;- cbind(uid, df_FTS)
res_list &lt;- split(x = df$score, f = df$uid)
raw_score &lt;- unlist(lapply(res_list, max))
uid_data &lt;- paste(df_data[, 1], df_data[, 2], sep = "_")
if (cdf.function == "exponential") {
lambda &lt;- MASS::fitdistr(raw_score, "exponential")$estimate
wE &lt;- stats::pexp(df_data$score, rate = lambda)
if (nrow(df_data) == 0) {
df_cGenes &lt;- NULL
}
else {
Gene &lt;- sapply(1:nrow(df_data), function(i) {
if (df_data$SNP_end[i] == "bait/from") {
df_data$to_genes[i]
}
else {
df_data$from_genes[i]
}
})
df_cGenes_ori &lt;- data.frame(Gene = Gene, SNP = df_data$SNP,
Sig = df_data$score, Weight = wE, row.names = NULL,
stringsAsFactors = FALSE)
ls_tmp &lt;- strsplit(df_cGenes_ori$Gene, ";")
res_ls &lt;- lapply(1:length(ls_tmp), function(i) {
x &lt;- ls_tmp[[i]]
x &lt;- x[x != "."]
data.frame(Gene = x, df_cGenes_ori[rep(i, length(x)),
-1], row.names = NULL, stringsAsFactors = FALSE)
})
df_cGenes &lt;- do.call(rbind, res_ls)
}
if (plot) {
hist(raw_score, breaks = 1000, freq = FALSE,
col = "grey", xlab = "Score", main = "")
curve(stats::dexp(x = raw_score, rate = lambda),
5:max(raw_score), col = 2, add = TRUE)
}
if (verbose) {
now &lt;- Sys.time()
message(sprintf("HiC weights are CDF of exponential empirical
distributions (parameter lambda=%f)",
lambda), appendLF = TRUE)
}
}
else if (cdf.function == "empirical") {
my.CDF &lt;- stats::ecdf(raw_score)
wE &lt;- my.CDF(df_data$score)
if (nrow(df) == 0) {
df_cGenes &lt;- NULL
}
else {
Gene &lt;- sapply(1:nrow(df_data), function(i) {
if (df_data$SNP_end[i] == "bait/from") {
df_data$to_genes[i]
}
else {
df_data$from_genes[i]
}
})
df_cGenes_ori &lt;- data.frame(Gene = Gene, SNP = df_data$SNP,
Sig = df_data$score, Weight = wE, row.names = NULL,
stringsAsFactors = FALSE)
ls_tmp &lt;- strsplit(df_cGenes_ori$Gene, ";")
res_ls &lt;- lapply(1:length(ls_tmp), function(i) {
x &lt;- ls_tmp[[i]]
x &lt;- x[x != "."]
data.frame(Gene = x, df_cGenes_ori[rep(i, length(x)),
-1], row.names = NULL, stringsAsFactors = FALSE)
})
df_cGenes &lt;- do.call(rbind, res_ls)
df_cGenes &lt;- df_cGenes[order(df_cGenes$Gene,
-df_cGenes$Sig, df_cGenes$SNP, decreasing = FALSE),
]
}
if (plot) {
plot(my.CDF, xlab = "Score", ylab = "Empirical CDF (HiC weights)",
main = "", xlim = c(0, 50))
}
if (verbose) {
now &lt;- Sys.time()
message(sprintf("HiC weights are CDF of empirical distributions"),
appendLF = TRUE)
}
}
if (verbose) {
now &lt;- Sys.time()
message(sprintf("%d cGenes are defined involving %d SNP",
length(unique(df_cGenes$Gene)), length(unique(df_cGenes$SNP))),
appendLF = TRUE)
}
}
else {
df_cGenes &lt;- NULL
if (verbose) {
now &lt;- Sys.time()
message(sprintf("No HiC genes are defined"), appendLF = TRUE)
}
}
if (!is.null(df_cGenes)) {
ind &lt;- xSymbol2GeneID(df_cGenes$Gene, details = FALSE,
verbose = verbose, RData.location = RData.location,
guid = guid)
df_cGenes &lt;- df_cGenes[!is.na(ind), ]
if (nrow(df_cGenes) == 0) {
df_cGenes &lt;- NULL
}
else {
if (1) {
ind &lt;- which(!grepl("^HIST", df_cGenes$Gene))
df_cGenes &lt;- df_cGenes[ind, ]
if (nrow(df_cGenes) == 0) {
df_cGenes &lt;- NULL
}
}
}
}
invisible(df_cGenes)
}
</pre>


</body></html>
